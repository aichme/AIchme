{"description": "### Summary\nA vulnerability in Coder's OIDC authentication could allow an attacker to bypass the `CODER_OIDC_EMAIL_DOMAIN` verification and create an account with an email not in the allowlist. Deployments are only affected if the OIDC provider allows users to create accounts on the provider (such as public providers like `google.com`).\n\n### Details\nDuring OIDC registration, the user's email was improperly validated against the allowed `CODER_OIDC_EMAIL_DOMAIN`s. This could allow a user with a domain that only partially matched an allowed domain to successfully login or register (e.g. `user@exploitcorp.com` would match the allowed domain `corp.com`).\n\nAn attacker could register a domain name that exploited this vulnerability and register on a Coder instance with a public OIDC provider.\n\n### Impact\nCoder instances with OIDC enabled and protected by the `CODER_OIDC_EMAIL_DOMAIN` configuration.\n\nCoder instances using a private OIDC provider are not affected, as arbitrary users cannot register through a private OIDC provider without first having an account on the provider.\n\nPublic OIDC providers (such as `google.com` without permitted domains set on the OAuth2 App) are impacted.\n\nGitHub authentication and external authentication are not impacted.\n\n### Was my deployment impacted?\nTo check if your deployment was exploited:\n- View the audit log on your deployment for unexpected registered users (using the `action:register` filter)\n- Check the users list for unexpected users\n    - Users created via this exploit will have a domain that ends with one of the allowed domains but doesn\u2019t fully match (e.g. `@exploitcorp.com` instead of `@corp.com`)\n\n### Patched Versions\nThis vulnerability is remedied in\n- v2.8.4\n- v2.7.3\n- v2.6.1\n\nAll versions prior to these patches are affected by the vulnerability. **It is recommended that customers upgrade their deployments as soon as possible if they are utilizing OIDC authentication with the `CODER_OIDC_EMAIL_DOMAIN` setting.**\n\n### Thanks\n- https://github.com/arcz\n- https://www.trailofbits.com\n\n### References\nhttps://github.com/coder/coder/security/advisories/GHSA-7cc2-r658-7xpf\nhttps://github.com/coder/coder/commit/4439a920e454a82565e445e4376c669e3b89591c\nhttps://nvd.nist.gov/vuln/detail/CVE-2024-27918", "methods": ["Bypasses email domain verification during OIDC registration.", "Allows users to register with partially matching domains.", "Uses public OIDC providers to register users.", "Exploits allowed domains to create accounts.", "Creates accounts with unexpected email domains.", "Uses unexpected registered users to gain access.", "Uses the `CODER_OIDC_EMAIL_DOMAIN` setting to gain access.", "Exploits OIDC authentication to gain access.", "Uses GitHub authentication and external authentication as a non-affected vector.", "Uses audit logs to identify unexpected registered users.", "Uses the users list to identify unexpected users.", "Uses the `action:register` filter to identify unexpected registered users."]}