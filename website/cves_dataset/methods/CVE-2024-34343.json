{"description": "### Summary\nThe `navigateTo` function attempts to blockthe `javascript:` protocol, but does not correctly use API's provided by `unjs/ufo`. This library also contains parsing discrepancies.\n\n### Details\nThe function first tests to see if the specified [URL has a protocol](https://github.com/nuxt/nuxt/blob/fa9d43753d25fc2e8c3107f194b2bab6d4ebcb9a/packages/nuxt/src/app/composables/router.ts#L142). This uses the [unjs/ufo](https://github.com/unjs/ufo) package for URL parsing. This function works effectively, and returns true for a `javascript:` protocol.\n\nAfter this, the URL is parsed using the [`parseURL`](https://github.com/unjs/ufo/blob/e970686b2acae972136f478732450f6a2f1ab5e5/src/parse.ts#L47) function. This function will refuse to parse poorly formatted URLs. Parsing `javascript:alert(1)` returns null/\"\" for all values. \n\nNext, the protocol of the URL is then checked using the [`isScriptProtocol`](https://github.com/unjs/ufo/blob/e970686b2acae972136f478732450f6a2f1ab5e5/src/utils.ts#L74) function. This function simply checks the input against a list of protocols, and does not perform any parsing. \n\nThe combination of refusing to parse poorly formatted URLs, and not performing additional parsing means that script checks fail as no protocol can be found. Even if a protocol was identified, whitespace is not stripped in the `parseURL` implementation, bypassing the `isScriptProtocol` checks. \n\nCertain special protocols are identified at the top of [`parseURL`](https://github.com/unjs/ufo/blob/e970686b2acae972136f478732450f6a2f1ab5e5/src/parse.ts#L49). Inserting a newline or tab into this sequence will block the special protocol check, and bypass the latter checks. \n\n### PoC\nPOC - https://stackblitz.com/edit/nuxt-xss-navigateto?file=app.vue\n\nAttempt payload X, then attempt payload Y.\n\n### Impact\nXSS, access to cookies, make requests on user's behalf. \n\n### Recommendations\nAs always with these bugs, the `URL` constructor provided by the browser is always the safest method of parsing a URL. \n\nGiven the cross-platform requirements of nuxt/ufo a more appropriate solution is to make parsing consistent between functions, and to adapt parsing to be more consistent with the [WHATWG URL specification](https://url.spec.whatwg.org/).\n\n### Note\nI've reported this vulnerability here as it is unclear if this is a bug in ufo or a misuse of the ufo library.\n\nThis ONLY has impact after SSR has occured, the `javascript:` protocol within a location header does not trigger XSS.\n", "methods": ["Used Cross-site Scripting (XSS) to access cookies and make requests on user's behalf.", "Used the `javascript:` protocol in a URL to bypass parsing and execute malicious code.", "Used newline or tab characters to bypass special protocol checks in the `parseURL` function.", "Used the `URL` constructor provided by the browser to parse URLs, which is a safer method.", "Used the `unjs/ufo` library for URL parsing, which has parsing discrepancies and inconsistencies.", "Used the `parseURL` function to refuse to parse poorly formatted URLs, which can be bypassed by inserting newline or tab characters."]}