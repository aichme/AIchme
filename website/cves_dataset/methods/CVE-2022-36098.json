{"description": "### Impact\nIt's possible to store Javascript or groovy scripts in an mention macro anchor or reference field. The stored code is executed by anyone visiting the page with the mention.\n\nFor example, the example below will create a file at `/tmp/exploit.txt`:\n\n```\n{{mention reference=\"XWiki.Translation\" anchor=\"{{/html~}~}{{async async=~\"true~\" cached=~\"false~\" context=~\"doc.reference~\"~}~}{{groovy~}~}new File(~\"/tmp/exploit.txt~\").withWriter { out -> out.println(~\"owned!~\"); }{{/groovy~}~}{{/async~}~}\"/}}\n```\n\n### Patches\nThis issue has been patched on XWiki 14.4 and 13.10.6.\n\n### Workarounds\nIt's possible to fix the vulnerability by updating `XWiki.Mentions.MentionsMacro` and edit the `Macro code` field of the `XWiki.WikiMacroClass` XObject.\n\n```velocity\n<a id=\"$anchor\" class=\"$stringtool.join($cssClasses, ' ')\" data-reference=\"$services.model.serialize($reference.reference, 'default')\" href=\"$link\">$content</a>\n```\n\nMust be replaced by \n\n```velocity\n<a id=\"$escapetool.xml($anchor)\" class=\"$stringtool.join($cssClasses, ' ')\" data-reference=\"$escapetool.xml($services.model.serialize($reference.reference, 'default'))\" href=\"$escapetool.xml($link)\">\n  $escapetool.xml($content)\n</a>\n```\n\nSee the patches:\n- 14.4: https://github.com/xwiki/xwiki-platform/commit/4f290d87a8355e967378a1ed6aee23a06ba162eb\n- 13.10.6: https://github.com/xwiki/xwiki-platform/commit/4032dc896857597efd169966dc9e2752a9fdd459#diff-4fe22885f772e47d3561a05348f73921669ec12d4413b220383b73c7ae484bc4R608-R610\n\n### References\n\n- https://jira.xwiki.org/browse/XWIKI-19752\n\n### For more information\nIf you have any questions or comments about this advisory:\n\n- Open an issue in [Jira XWiki.org](https://jira.xwiki.org/)\n- Email us at [Security Mailing List](mailto:security@xwiki.org)", "methods": ["Stored Cross-site Scripting (XSS) via mention macro anchor or reference field.", "Stored Groovy scripts executed by visiting the page with the mention.", "Stored JavaScript scripts executed by visiting the page with the mention.", "Use of `groovy` macro to execute arbitrary code.", "Use of `async` macro to execute code in the background.", "Use of `withWriter` method to write to a file.", "Use of `println` method to print to a file.", "Use of `File` class to interact with the file system.", "Use of `serialize` method to serialize data.", "Use of `escape` method to prevent XSS.", "Use of `xml` method to escape XML data.", "Use of `join` method to concatenate strings.", "Use of `serialize` method to serialize data.", "Use of `reference` field to store and execute malicious code.", "Use of `anchor` field to store and execute malicious code.", "Use of `content` field to store and execute malicious code.", "Use of `link` field to store and execute malicious code.", "Use of `cssClasses` field to store and execute malicious code.", "Use of `services.model` to interact with the XWiki model.", "Use of `XWiki.WikiMacroClass` to interact with the XWiki macro system.", "Use of `XWiki.Mentions.MentionsMacro` to interact with the mentions macro system.", "Use of `XWiki.Translation` to interact with the translation system.", "Use of `Jira` to track and manage vulnerabilities.", "Use of `email` to communicate with the security mailing list.", "Use of `mail` to communicate with the security mailing list."]}