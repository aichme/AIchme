{"description": "A flaw was found in Keycloak. Under specific circumstances, HTML entities are not sanitized during user impersonation, resulting in a Cross-site scripting (XSS) vulnerability.\n\n## Details\n\nThis issue is the result of code found in the exception here: [https://github.com/keycloak/keycloak/blob/48835576daa158443f69917ac309e1a7c951bc87/services/src/main/java/org/keycloak/authentication/AuthenticationProcessor.java#L1045](https://github.com/keycloak/keycloak/blob/48835576daa158443f69917ac309e1a7c951bc87/services/src/main/java/org/keycloak/authentication/AuthenticationProcessor.java#L1045)\n\n## Steps to reproduce\n\nWhen using the legacy admin console:\n\n1. Sign in as Admin user in first tab.\n2. In that tab create new user in keycloak admin section > intercept user creation request and modify it by including malicious js script there (in username field).\n3. Sign in as newly created user in second tab (same browser window but second tab).\n4. Navigate back to first tab where you are signed in as admin, navigate to admin console which lists all application users.\n5. Choose any user (except newly created malicious one) \u2013 modify anything for that user in his settings. E.g. navigate to credentials tab and set new credentials for him. Also set new password as temporary.\n6. After update for that user is made, use impersonate option on that modified user.\n7. You should see window with form which requires providing new credentials \u2013 fill it and submit request.\n8. Just after submiting request user will get notified that \u201cYou are already authenticated as different user \u2018[user + payload]\u2019 in this session. Please sign out first.\u201d  And malicious payload will be executed instantly.\n", "methods": ["Injects malicious JavaScript code via user input in the username field.", "Uses the \"impersonate\" feature to execute malicious payload.", "Uses the \"impersonate\" feature to execute malicious payload in the context of a user session.", "Uses the \"impersonate\" feature to execute malicious payload without user interaction."]}