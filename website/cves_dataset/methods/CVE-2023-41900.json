{"description": "If a Jetty `OpenIdAuthenticator` uses the optional nested `LoginService`, and that `LoginService` decides to revoke an already authenticated user, then the current request will still treat the user as authenticated. The authentication is then cleared from the session and subsequent requests will not be treated as authenticated. \n\nSo a request on a previously authenticated session could be allowed to bypass authentication after it had been rejected by the `LoginService`.\n\n### Impact\nThis impacts usages of the jetty-openid which have configured a nested `LoginService` and where that `LoginService` will is capable of rejecting previously authenticated users.\n\n### Original Report\n> working on a custom OpenIdAuthenticator, I discovered the following:\n> \n> https://github.com/eclipse/jetty.project/blob/jetty-10.0.14/jetty-openid/src/main/java/org/eclipse/jetty/security/openid/OpenIdAuthenticator.java#L505\n> \n> In the case where the LoginService does return that the authentication has been revoked (from the validate() call on line 463), the OpenIdAuthenticator removes the authentication from the session; however the current request still proceeds as if authenticated, since it falls through to \"return authentication\" on line 505.\n> \n> This is fixed by moving the line 505 (and associated debug log) inside the else block that ends on line 502, instead of outside it. Then the revocation case will run through to line 517 and will trigger a new OpenId authentication which I think is correct.\n> \n> I think this revocation can only occur if you do attach a separate LoginService to the OpenIdLoginService, but in that case the revoked authentication will still let the next request through (and possibly more than one if they are very close to simultaneous).\n> \n> Technically I think this is a security vulnerability, if a very minor one, so I'm sending this off-list.\n\n### Patched Versions\n\nFixed in Jetty Versions:\n* 9.4.52 - fixed in PR https://github.com/eclipse/jetty.project/pull/9660\n* 10.0.16 - fixed in PR https://github.com/eclipse/jetty.project/pull/9528\n* 11.0.16 - fixed in PR https://github.com/eclipse/jetty.project/pull/9528\n* 12.0.0 - not impacted (already has fix)\n\n### Workaround\nUpgrade your version of Jetty.\n\n### References\n* https://github.com/eclipse/jetty.project/pull/9528\n* https://github.com/eclipse/jetty.project/pull/9660", "methods": ["The vulnerability allows an authenticated user to bypass authentication on a previously rejected request.", "The issue is due to the OpenIdAuthenticator not properly handling the revocation of authentication by the LoginService.", "The authentication is cleared from the session, but the request is still treated as authenticated.", "The vulnerability can be exploited by a user who has been previously authenticated and then has their authentication revoked by the LoginService.", "The issue is fixed by moving the line of code that handles the revocation case inside the else block.", "The vulnerability is fixed in Jetty versions 9.4.52, 10.0.16, 11.0.16, and 12.0.0.", "The issue is patched in PRs 9528 and 9660.", "The workaround is to upgrade the version of Jetty."]}